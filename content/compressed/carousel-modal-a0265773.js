function toggleFollow(a){CB.follow(a)}function toggleLike(b,a){CB.like(b,function(c){if(a){$.each(a,function(d,e){window[e](b,c)})}})}function toggler(){$.each($(".toggle"),function(c,d){a(d)});function b(e,d,c){$.each(e,function(f,g){window[g](d,c)})}$(".toggle").bind("click",function(i){i.preventDefault();var c,h,k,f,j,g;c=$(this);k=c.data("actions").split(",");h=c.data("state").split(",");if(c.data("state-text")){j=c.data("state-text").split(",")}if(c.data("hover")){f=c.data("hover").split(",")}if(c.data("callbacks")){g=c.data("callbacks").split(",")}b(k,c,g);var d=c.data("toggle-class");if(d){$("."+d).each(function(){var e=$(this);if(e.hasClass(h[0])){e.removeClass(h[0]);e.addClass(h[1]);if(j){e.html(j[1])}if(f){e.hover(function(){e.data("initialText",e.text());e.html(f[1])},function(){if(j){e.html(j[1])}})}}else{e.removeClass(h[1]);e.addClass(h[0]);if(j){e.html(j[0])}if(f){e.hover(function(){e.html(f[0])},function(){if(j){e.html(j[0])}})}}})}else{if(c.hasClass(h[0])){c.removeClass(h[0]);c.addClass(h[1]);if(j){c.html(j[1])}if(f){c.hover(function(){c.data("initialText",c.text());c.html(f[1])},function(){if(j){c.html(j[1])}})}}else{c.removeClass(h[1]);c.addClass(h[0]);if(j){c.html(j[0])}if(f){c.hover(function(){c.html(f[0])},function(){if(j){c.html(j[0])}})}}}});function a(e){var c,f,g,d;c=$(e);f=c.data("state").split(",");if(c.data("state-text")){g=c.data("state-text").split(",")}if(c.data("hover")){d=c.data("hover").split(",")}if(c.data("initial-state")){if(c.data("initial-state")==f[0]){c.removeClass(f[1]);c.addClass(f[0]);if(g){c.html(g[0])}if(d){c.hover(function(){c.html(d[0])},function(){if(g){c.html(g[0])}})}}else{c.removeClass(f[0]);c.addClass(f[1]);if(g){c.html(g[1])}if(d){c.hover(function(){c.html(d[1])},function(){if(g){c.html(g[1])}})}}}}}(function(c){var b={};c.fn.template=function a(d,e){return this.html(c.template(d,e))};c.template=function a(f,g){try{var d=!/\W/.test(f)?b[f]=b[f]||a(document.getElementById(f).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+f.replace(/[\r\t\n]/g,"").split("[!").join("\t").replace(/((^|!\])[^\t]*)'/g,"$1\r").replace(/\t=(.*?)!\]/g,"',$1,'").split("\t").join("');").split("!]").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return g?d(g):d}catch(h){console.log("err:",h)}}})(jQuery);$(".carousel").on("slide.bs.carousel",function(c){var a;var b=$(this).data("max");var d=$("#"+this.id+" .carousel-inner .item.active").attr("id").substr(6);if(b<2){return false}if(c.direction=="right"){d++}else{d--}if(d>b){d=1}if(d<1){d=b}if($("#"+this.id+" .carousel-inner #large-"+d).length){return true}a=$("#"+this.dataset.items).children();if(this.id.indexOf("user")>-1){a.splice(0,3)}enlarge($(a[b-d]).children().children()[0]);return false});function loadComments(c){var a={context_id:c,context_type:"gallery"};$.ajax({url:CB.config.api.comment.get+"/"+a.context_id+"/?context_type="+a.context_type,type:"POST",dataType:"json",data:{},success:function(e){if(e.success===true){var d=".comments-"+a.context_id;$(d).html("");$.each(e.comments.comments,function(g,h){var i={comment:h};i.delete_class=(CB.user_id==h.owner_id||CB.user_id==h.member_id)?"delete on":"delete";i.report_class=CB.user_id!=h.member_id?"report on":"report";i.like_class=CB.user_id!=h.member_id?"like on":"like";h.likers.forEach(function(j){if(+CB.user_id===+j.member_id){i.like_class+=" liked"}});var f=$.template("template_gallery_comment",i);$(d).append(f)});cbEffects.bindEffects()}}});var b=$(".comments-"+a.context_id).parent();b.each(function(d,e){var f=$(e);if($(f).data("init")){return}$(f).data("init",1);$("button",f).bind("click",function(h){if($("textarea",f).val().length<2){return}if(CB.user_id===null){return}var g=$("textarea",f);$.ajax({url:CB.config.api.comment.add,type:"POST",dataType:"json",data:{api_key:CB.config.api.key,context_id:g.data("context-id"),parent_id:g.data("parent-id"),context_type:g.data("context-type"),owner_id:g.data("owner-id"),text:g.val(),format:"json"},success:function(j){if(j.success===true){console.log(j);$(".comments-cnt-"+a.context_id).text(j.count);g.val("");var i=".comments-"+a.context_id;console.log("here",i);j.delete_class="delete on";j.report_class="report";j.like_class="like on";var k=$.template("template_gallery_comment",j);$(i).prepend(k);cbEffects.bindEffects()}}})})})}function enlarge(g){var f=$(g).data("target");var k=$(g).data("id");var j=$(g).parent().parent();var d=$(j).index();var a=$(j).parent().children().length;console.log($(g));if(f.indexOf("user")>-1){d-=3;a-=3}var b=a-d;$(f+"-carousel").data("max",a);$(f+" .carousel-inner .item").removeClass("active");if($(f+" #large-"+b).length){$(f+" #large-"+b).addClass("active");return}if($(f+" .carousel-inner .item").length==2){$(f+" .carousel-inner #large-0").remove()}var h=false;$(f+" .carousel-inner .item").each(function(c,l){var c=l.id.substr(6);if(b<c){h=l}});$.ajax({url:CB.config.api.member.enlarge_image,type:"POST",dataType:"json",data:{image_id:k,image_type:$(g).data("type"),carousel_id:f+"-carousel",format:"json"},success:function(c){if(c.success===true){var e='<div id="large-'+b+'" class="item active">'+c.html+"</div>";if(!h){var i=$(f+" .carousel-inner .item")[0];$(i).before(e)}else{$(h).after(e)}$(".toggle").unbind("click");toggler();loadComments(k)}}})};
(function(){window.cbVid=window.cbVid||{};window.cbVid.bindChapterCtrls=function(){$(".table").on("click","tr",function(c){var a=$(this).closest(".chapters-pane").data("slug");var b=$(this).data("index");if(b==undefined){return}if(a){document.location=location.protocol+"//"+location.host+a+"/"+b}else{jwplayer("videoplayer").pause(false);resume=false;setTimeout(function(){playVideoByIndex(b)},1)}})}}());$(function(){var i={viewTime:0,lastPosition:0,};var j={active:false,bufferTime:0,lastPos:0,interval:500,startTimestamp:0,};var d=false;trackingInfo.vidTotal=videos.length;var l=false;var c=true;function e(){setTimeout(function(){if(!c){return}document.location.href=ads},1000)}function k(n){var m=["send","event","video",n.primary_subject_id+"-"+n.slug,(n.vidCurr+1)+":"+n.vidTotal+"-"+n.event];ga.apply(null,m)}window.addEventListener("unload",function(){ga("send","event","video","watched seconds",trackingInfo.primary_subject_id+"-"+trackingInfo.slug,parseInt(i.viewTime));ga("send","event","video","buffered seconds",trackingInfo.primary_subject_id+"-"+trackingInfo.slug,parseInt(j.bufferTime/1000))});jwplayer("videoplayer").onReady(function(){window.setInterval(function(){var o=jwplayer("videoplayer").getPosition();if(j.active){if(o===j.lastPos&&j.startTimestamp===0){j.startTimestamp=(new Date).getTime()}else{if(o!==j.lastPos&&j.startTimestamp!==0){var n=(new Date).getTime();j.bufferTime+=n-j.startTimestamp;j.startTimestamp=0}}}j.lastPos=o},j.interval);if(jwplayer().getRenderingMode()=="flash"){return}tag=document.querySelector("video");tag.defaultPlaybackRate=1;tag.playbackRate=1;jwplayer().addButton("/ui/vendor/jwplayer-7.3.6/snail.png","Slow Motion",function(){jwplayer().seek(jwplayer().getPosition());tag.playbackRate=0.3},"slow");jwplayer().addButton("/ui/vendor/jwplayer-7.3.6/normal.png","Normal Speed",function(){jwplayer().seek(jwplayer().getPosition());tag.playbackRate=1},"normal");var m=/iPad|iPhone|iPod/.test(navigator.userAgent);if(m){return}jwplayer().addButton("/ui/vendor/jwplayer-7.3.6/hare.png","High Speed",function(){jwplayer().seek(jwplayer().getPosition());tag.playbackRate=3},"high")});jwplayer("videoplayer").addButton("/ui/vendor/jwplayer-7.1.0/rewind2.png","Replay the last 20 seconds",function(){var m=Math.round(jwplayer("videoplayer").getPosition())-20;if(m<0){m=0}setTimeout(function(){jwplayer("videoplayer").seek(m)},1)},"rewind");jwplayer("videoplayer").onPlaylistComplete(function(){if(!has_reviewed){$("#review_class_modal").modal("show")}$(".fakeVideoCover").addClass("active");$("#videoPostPlate").removeClass("hidden");$("#share-flag").show();videoRendered=false});jwplayer("videoplayer").onPlay(function(){j.active=true;var m=jwplayer("videoplayer").getPlaylistIndex();if(editing){setTimeout(function(){jwplayer("videoplayer").pause(true)},100);editing=false}else{if(resume&&m==resume.index){resume=false}if($("#description").hasClass("active")){$("#video-nav li:eq(1) a").tab("show")}}});jwplayer("videoplayer").onPause(function(){j.active=false});jwplayer("videoplayer").onComplete(function(){var m=jwplayer("videoplayer").getPlaylistIndex();trackingInfo.vidCurr=m;trackingInfo.event="end-jwplayer";k(trackingInfo);j.active=false});jwplayer("videoplayer").onPlaylistItem(function(m){trackingInfo.vidCurr=m.index;trackingInfo.event="start-jwplayer";k(trackingInfo);if(editing){if(m.index!=editing.index){jwplayer("videoplayer").playlistItem(editing.index);return}this.seek(editing.pos);setTimeout(function(){jwplayer("videoplayer").play()},100);return}if(d&&resume&&m.index==resume.index){setTimeout(function(){jwplayer("videoplayer").seek(resume.pos)},500)}d=true;if(resume){$("#video-nav li:eq(1) a").tab("show");m.index=resume.index}selectChapter(m.index);if(videoRendered){trackVideoPlay(m.index);if($("#annotations").hasClass("active")){renderAnnotations(m.index)}if($("#transcript").hasClass("active")){renderTranscript(m.index)}}});jwplayer("videoplayer").onTime(function(q){var r=Math.floor(q.position);var p=new Date().getTime();if(p-lastResumeTime>3000){if(member_id){var n=jwplayer("videoplayer").getPlaylistIndex();var m=new Image();m.src="//cbug-1.appspot.com/save_resume/?member_id="+member_id+"&position="+r+"&video_id="+ids[n]["video_id"]+"&chapter_id="+ids[n]["chapter_id"]+"&tutorial_id="+ids[n]["tutorial_id"]}lastResumeTime=p}i.viewTime=i.viewTime+Math.max(0,q.position-i.lastPosition);i.lastPosition=q.position;if(!$("#transcript").hasClass("active")){return}var o=$('#transcript a[data-pos~="'+r+'"]');if(!o.length){return}$("#transcript a").removeClass("on");o.addClass("on");if(p-lastAutoScrollTime>2000){scrollToElement($("#video-tabs"),o);lastAutoScrollTime=p}});jwplayer("videoplayer").onSeek(function(n){i.lastPosition=n.offset;j.active=false;if(!n.offset){n.offset=0}var o=Math.round(n.offset);var m=jwplayer("videoplayer").getPlaylistIndex();if(annotations[m]["s"+o]!=null){selected={pos:o,index:m};$("#note").val(annotations[m]["s"+o])}else{selected=false}});$(".fakeVideoCover").bind("click",function(){if($(".fakeVideoCover").hasClass("loading")){return}if($(".fakeVideoCover").hasClass("ads")){document.location.href=ads;return}if(!$(".fakeVideoCover").hasClass("resume")&&!$(".fakeVideoCover").hasClass("register")){playVideoByIndex(0)}});$("#but-annotations").bind("click",function(){ga("send","event","video player buttons","click","click annotations button");if($("#annotations").hasClass("active")){$("#new-annotation").trigger("click")}});window.renderTranscript=function(m){$.ajax({url:"/api/v1/workshop/transcript/"+ids[m]["video_id"],error:function(n){},success:function(n){var p="";for(var q=0;q<n.captions.length;q++){var r=Math.floor(n.captions[q].position);var o=$.map($(Array(Math.ceil(n.captions[q].duration))),function(t,s){return r+s});p+='<a href="javascript:;" data-pos="'+o.join(" ")+'" onclick="goCaption(this,'+r+');">'+n.captions[q].text+"</a> "}$(".transcript-pane").html(p)}})};window.renderAnnotations=function(r){var o='<table class="table table-hover">';var t=[];if(!annotations[r]){o+='<tr><td width="90">No notes yet.</td></tr>'}else{for(var w in annotations[r]){var u=Number(w.substr(1));var q=Math.floor(u/3600);var n=Math.floor(u%3600/60);var x=Math.floor(u%3600%60);var v=(q>0?(q>=10?q:"0"+q)+":":"")+(n>0?(n>=10?n:"0"+n):"00")+":"+(x>0?(x>=10?x:"0"+x):"00");t.push({time:u,hms:v,text:annotations[r][w]})}t.sort(function(s,m){return s.time-m.time});for(var p=0;p<t.length;p++){o+='<tr data-pos="'+t[p].time+'" onclick="return goAnnotation(this);"><td width="90"><img style="width:16px; margin:0 9px 0 0" src="/ui/images/annotation-flag-gray.svg"/>'+t[p].hms+"</td><td>"+t[p].text+'</td>                <td style="text-align:right">                <button type="button" class="btn btn-info" data-toggle="modal" data-target="#annotations-modal" onclick="selectAnnotation(this);">Edit</button>                <button type="button" class="btn btn-default" data-toggle="modal" data-target="#confirmation-modal" onclick="selectAnnotation(this);">Delete</button>                </td></tr>'}}o+="</table>";$(".annotations-pane").html(o)};window.goCaption=function(m,o){$("#transcript a").removeClass("on");$(m).addClass("on");if(!videoRendered){videoRendered=true;$(".fakeVideoCover").removeClass("active");$("#videoplayer").addClass("big");$("#videoPostPlate").addClass("hidden");$("#share-flag").hide();var n=jwplayer("videoplayer").getPlaylistIndex();trackVideoPlay(n)}jwplayer().seek(o)};window.goAnnotation=function(m){if(editing){return}var n=$(m).data("pos");setTimeout(function(){jwplayer("videoplayer").pause(false);jwplayer("videoplayer").seek(n)},1)};window.selectAnnotation=function(m){jwplayer("videoplayer").pause(true);$("#note").val($(m).parent().prev().text());var o=$(m).parent().parent().data("pos");var n=jwplayer("videoplayer").getPlaylistIndex();editing={pos:o,index:n}};window.newAnnotation=function(m){jwplayer("videoplayer").pause(true);$("#note").val("");editing={pos:Math.round(jwplayer("videoplayer").getPosition()),index:jwplayer("videoplayer").getPlaylistIndex()}};$("#annotations-modal").on("show.bs.modal",function(m){setTimeout(function(){var n=$("#note").val();$("#note").focus().val("").val(n)},800)});$("#annotations-modal, #confirmation-modal").on("hidden.bs.modal",function(m){editing=false});$("#delete-annotation").bind("click",function(){var m=editing.index;var n=editing.pos;$.ajax({url:"/api/v1/workshop/delete_annotation",type:"post",data:{video_id:ids[m]["video_id"],position:editing.pos},error:function(o){editing=false},success:function(o){if(o.error){editing=false;alert(o.error);return}annotations[m]=o.annotations;renderAnnotations(m);editing={pos:n,index:m};jwplayer("videoplayer").load(videos)}})});$("#save-annotation").bind("click",function(){var m=editing.index;var n=editing.pos;$.ajax({url:"/api/v1/workshop/save_annotation",type:"post",data:{video_id:ids[m]["video_id"],chapter_id:ids[m]["chapter_id"],tutorial_id:ids[m]["tutorial_id"],position:editing.pos,text:$("#note").val()},error:function(o){editing=false},success:function(o){if(o.error){editing=false;alert(o.error);return}annotations[m]=o.annotations;renderAnnotations(m);$("#but-annotations").tab("show");editing={pos:n,index:m};jwplayer("videoplayer").load(videos);setTimeout(function(){jwplayer("videoplayer").seek(n)},200)}})});$("#but-bookmark").bind("click",function(){ga("send","event","video player buttons","click","click bookmark button");var m=$(this).parent();var n="/api/v1/bookmark"+($(m).hasClass("on")?"/remove/":"/add/")+ids[0]["tutorial_id"];if(active_part){n+="/"+ids[0]["chapter_id"]}$.ajax({url:n,dataType:"json",success:function(o){if(o.result){$(m).toggleClass("on")}}})});window.scrollToElement=function(n,m){var o=$(m).offset().top+$(n).scrollTop()-$(n).offset().top;if(o<$(n).scrollTop()||o>$(n).scrollTop()+$(n).height()){$(n).animate({scrollTop:o},1000)}};window.trackVideoPlay=function(m){$.ajax({url:"/api/v1/workshop/viewed",dataType:"json",data:{video_id:ids[m]["video_id"]},success:function(n){}});$.ajax({url:"/api/v1/workshop/chapter_viewed",dataType:"json",data:{chapter_id:ids[m]["chapter_id"],tutorial_id:ids[m]["tutorial_id"]},success:function(n){}})};window.restartPlay=function(){resume=false;if(!videoRendered){videoRendered=true;$(".fakeVideoCover").removeClass("active");$("#videoplayer").addClass("big");$("#videoPostPlate").addClass("hidden");$("#share-flag").hide();trackVideoPlay(0)}selectChapter(0);jwplayer("videoplayer").seek(0);setTimeout(function(){jwplayer("videoplayer").pause(false);jwplayer("videoplayer").play()},100)};window.selectChapter=function(m){if(ads){if(m!=0){$(".fakeVideoCover").removeClass("ads");if(l){ads=l}}if(m==videos.length-1){$(".fakeVideoCover").addClass("ads");l=ads;ads=$("#videoPostPlate a").attr("href");return}m--}var n=$("#video-tabs tr[data-index='"+m+"'] > td > div > label").text();$(".nowplaying strong").text(n);$("#video-tabs tr").removeClass("active");$("#video-tabs tr[data-index='"+m+"']").addClass("active")};window.playVideoByIndex=function(n,p){if(ads){if(n==0){$(".fakeVideoCover").addClass("ads");var m=document.getElementsByTagName("video")[0];if(m){m.addEventListener("pause",e,false);m.addEventListener("ended",function(){c=false},false)}}if(n!=0){n++}}$("html, body").animate({scrollTop:$(".fakeVideoCover").offset().top-50},1000);if(!videoRendered){videoRendered=true;$(".fakeVideoCover").removeClass("active");$("#videoplayer").addClass("big");$("#videoPostPlate").addClass("hidden");$("#share-flag").hide();trackVideoPlay(n)}if(resume&&resume.index==0){setTimeout(function(){jwplayer("videoplayer").seek(resume.pos)},500);return}selectChapter(n);jwplayer("videoplayer").playlistItem(n);var o=document.getElementById("videoplayer");o.tabIndex=1234;o.focus()};window.cbVid.bindChapterCtrls();(window.onresize=function(n){var m=$(window).width()*0.5625;$(".fakeVideoCover").css({"max-height":"600px"});$(".fakeVideoCover").css({height:m})})();var f=0;var b=0;var g=false;var a=false;(window.fadeMenu=function(){clearTimeout(g);g=setTimeout(function(){g=false;var m=($("#header").offset().top-$(window).scrollTop());if(m<-90){m=-90}if(m>0){m=0}$("#header").css({top:m,position:"fixed"});if($(window).scrollTop()>90){setTimeout(function(){$("#header").css({top:-94})},100);f=$(window).scrollTop();b=0}},5000)})();if(navigator.userAgent.match(/(iPad|iPhone|iPod)/g)){document.addEventListener("touchmove",h,false)}else{document.addEventListener("scroll",h,false)}function h(){var o=0;var m=$(this).scrollTop();if(m<0){m=0}if(m>f){o=1}if(m<f){o=-1}if(o!=b){if(o==1){$("#header").css({top:m,position:"absolute"})}else{if(o==-1){var n=($("#header").offset().top-m);if(n<-90){n=-90}if(n>0){n=0}$("#header").css({top:n,position:"fixed"});setTimeout(function(){$("#header").css({top:0,position:"fixed"})},100)}}b=o}f=m;fadeMenu()}$("#video-wrapper").bind("mousemove",function(m){clearTimeout(a);$("#video-buttons").show()});$("#video-wrapper").bind("mouseout",function(m){clearTimeout(a);if(j.active){a=setTimeout(function(){$("#video-buttons").hide()},100)}});$("#header").bind("mousemove",function(m){if(g){clearTimeout(g);g=false}});$("#header").bind("mouseout",function(m){if(!$("#header").hasClass("searchon")){fadeMenu()}});$('a[data-toggle="tab"]').on("show.bs.tab",function(o){var n=o.target.hash.substr(1);ga("send","event","video player buttons","show tab","show "+n+" tab");$("#video-tabs")[0].scrollTop=0;$("#video-tabs").addClass("noscroll");if(n=="discussions"){$("html, body").animate({scrollTop:$("#comments").offset().top},1000);return false}if(n=="transcript"){$("#video-tabs").removeClass("noscroll");$("html, body").animate({scrollTop:$(".fakeVideoCover").offset().top-50},1000);var m=jwplayer("videoplayer").getPlaylistIndex();renderTranscript(m)}if(n=="annotations"){$("html, body").animate({scrollTop:$(".fakeVideoCover").offset().top-50},1000);var m=jwplayer("videoplayer").getPlaylistIndex();if(!annotations[m]){setTimeout(function(){$("#new-annotation").trigger("click")},100)}renderAnnotations(m)}})});